<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.58.&nbsp;Tracked entity instance management</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer Manual"><link rel="up" href="ch01.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="ch01s57.html" title="1.57.&nbsp;SVG conversion"><link rel="next" href="ch01s59.html" title="1.59.&nbsp;Tracked entity instance query"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.58.&nbsp;Tracked entity instance management</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s57.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch01s59.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e11996"></a>1.58.&nbsp;Tracked entity instance management</h2></div></div></div><p>Tracked entity instances have full CRUD (create, read, update, delete) support in the
      Web-API. Together with the API for enrollment most operations needed for working with tracked
      entity instances and programs are supported.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12001"></a>1.58.1.&nbsp;Creating a new tracked entity instance</h3></div></div></div><p>For creating a new person in the system, you will be working with the <span class="italic">trackedEntityInstances</span> resource. A template payload can be seen
        below:</p><pre class="screen">{
    "trackedEntity": "tracked-entity-id",
    "orgUnit": "org-unit-id",
    "attributes": [ {
        "attribute": "attribute-id",
        "value": "attribute-value"
    } ]
}</pre><p>For getting the IDs for <span class="italic">relationship</span>, <span class="italic">attributes</span> you can have a look at the respective resources
          <span class="italic">relationshipTypes</span>,, <span class="italic">trackedEntityAttributes</span>. To create a tracked entity instance you must use the
        HTTP <span class="bold"><strong>POST</strong></span> method. You can post the payload the the
        following URL:</p><pre class="screen">/api/trackedEntityInstances</pre><p> For example, let us create a new instance of a person tracked entity and specify its
        first name and last name
        attributes:</p><pre class="screen">{
  "trackedEntity": "nEenWmSyUEp",
  "orgUnit": "DiszpKrYNg8",
  "attributes": [
    {
      "attribute": "w75KJ2mc4zz",
      "value": "Joe"
    },
    {
      "attribute": "zDhUuAYrxNC",
      "value": "Smith"
    }
  ]
}</pre><p>To push this to the server you can use the cURL command like
        this:</p><pre class="screen">curl -d @tei.json "https://play.dhis2.org/demo/api/trackedEntityInstances" -X POST 
-H "Content-Type: application/json" -u admin:district -v</pre><p>To create multiple instances in one request you can wrap the payload in an outer array
        like this and POST to the same resource as
        above:</p><pre class="screen">{
  "trackedEntityInstances": [
    {
      "trackedEntity": "nEenWmSyUEp",
      "orgUnit": "DiszpKrYNg8",
      "attributes": [
        {
          "attribute": "w75KJ2mc4zz",
          "value": "Joe"
        },
        {
          "attribute": "zDhUuAYrxNC",
          "value": "Smith"
        }
      ]
    },
    {
      "trackedEntity": "nEenWmSyUEp",
      "orgUnit": "DiszpKrYNg8",
      "attributes": [
        {
          "attribute": "w75KJ2mc4zz",
          "value": "Jennifer"
        },
        {
          "attribute": "zDhUuAYrxNC",
          "value": "Johnson"
        }
      ]
    }
  ]
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12042"></a>1.58.2.&nbsp;Updating a tracked entity instance</h3></div></div></div><p>For updating a tracked entity instance, the payload is the equal to the previous
        section. The difference is that you must use the HTTP <span class="bold"><strong>PUT</strong></span>
        method for the request when sending the payload. You will also need to append the person
        identifier to the <span class="italic">trackedEntityInstances</span> resource in the
        URL like this, where &lt;tracked-entity-instance-identifier&gt; should be replaced by the
        identifier of the tracked entity instance:</p><pre class="screen">/api/trackedEntityInstances/&lt;tracked-entity-instance-id&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12055"></a>1.58.3.&nbsp;Deleting a tracked entity instance</h3></div></div></div><p>To delete a tracked entity instance you can make a request to the URL identifiying the
        tracked entity instance with the HTTP <span class="bold"><strong>DELETE</strong></span> method. The
        URL is equal to the one above used for update.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12063"></a>1.58.4.&nbsp;Enrolling a tracked entity instance into a program</h3></div></div></div><p>For enrolling persons into a program, you will need to first get the identifier of the
        person from the <span class="italic">trackedEntityInstances</span> resource. Then,
        you will need to get the program identifier from the <span class="italic">programs</span> resource. A template payload can be seen
        below:</p><pre class="screen">{
  "trackedEntityInstance": "ZRyCnJ1qUXS",
  "orgUnit": "ImspTQPwCqd",
  "program": "S8uo8AlvYMz",
  "enrollmentDate": "2013-09-17",
  "incidentDate": "2013-09-17"
}</pre><p>This payload should be used in a <span class="bold"><strong>POST</strong></span> request to the
        enrollments resource identified by the following URL:</p><pre class="screen">/api/enrollments</pre><p>For cancelling or completing an enrollment, you can make a <span class="bold"><strong>PUT</strong></span> request to the <span class="italic">enrollments</span> resource,
        including the identifier and the action you want to perform. For cancelling an enrollment
        for a tracked entity
        instance:</p><pre class="screen">/api/enrollments/&lt;enrollment-id&gt;/cancelled</pre><p>For completing a enrollment for a tracked entity instance you can make a <span class="bold"><strong>PUT</strong></span> request to the following
        URL:</p><pre class="screen">/api/enrollments/&lt;enrollment-id&gt;/completed</pre><p>For deleting a enrollment, you can make a <span class="bold"><strong>DELETE</strong></span>
        request to the following URL:</p><pre class="screen">/api/enrollments/&lt;enrollment-id&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12107"></a>1.58.5.&nbsp;Update strategies</h3></div></div></div><p>Two update strategies for tracked entity instance are supported: enrollment and event
        creation. This is useful when you have generated an identifier on the client side and are
        not sure if it was created or not on the server.</p><div class="table"><a name="d0e12112"></a><p class="title"><b>Table&nbsp;1.92.&nbsp;Available tracker strategies</b></p><div class="table-contents"><table class="table" summary="Available tracker strategies" border="1"><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>CREATE</td><td>Create only, this is the default behavior.</td></tr><tr><td>CREATE_AND_UPDATE</td><td>Try and match the ID, if it exist then update, if not create.</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>To change the parameter, please use the strategy
        parameter:</p><pre class="screen">POST /api/trackedEntityInstances?strategy=CREATE_AND_UPDATE</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12139"></a>1.58.6.&nbsp;Create and enroll tracked entity instances</h3></div></div></div><p>It is also possible to both create (and update) a tracked entity instance and at the
        same time enroll into a program.</p><pre class="screen">{
    "trackedEntity": "tracked-entity-id",
    "orgUnit": "org-unit-id",
    "attributes": [ {
        "attribute": "attribute-id",
        "value": "attribute-value"
    } ],
    "enrollments": [ {
        "orgUnit": "org-unit-id",
        "program": "program-id",
        "enrollmentDate": "2013-09-17",
        "incidentDate": "2013-09-17"
     }, {
        "orgUnit": "org-unit-id",
        "program": "program-id",
        "enrollmentDate": "2013-09-17",
        "incidentDate": "2013-09-17"
     } ]
}</pre><p>You would send this to the server as you would normally when creating or updating a new
        tracked entity
        instane.</p><pre class="screen">curl -X POST -d @tei.json -H "Content-Type: application/json"
  -u user:pass http://server/api/24/trackedEntityInstances</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12150"></a>1.58.7.&nbsp;Generated tracked entity instance attributes</h3></div></div></div><p>Tracked entity instance attributes that is using automatic generation of unique values
        has two endpoints that is used by apps. One is used to generate values, the other to
        generate and reserve one or more values for use later.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12155"></a>1.58.7.1.&nbsp;Generate value endpoint</h4></div></div></div><p>Online web apps and other clients that wants to generate a value that will be used
          right away can use the simple generate endpoint. This endpoint will generate a value that
          is guaranteed to be unique at the time of generation. The value is also guaranteed not to
          be reserved by use of the generateAndReseve endpoint.</p><pre class="screen">curl -X GET -H "Content-Type: application/json" -u admin:district 
          https://play.dhis2.org/dev/api/trackedEntityAttributes/lZGmxYbs97q/generate</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12162"></a>1.58.7.2.&nbsp;Generate and reserve value endpoint</h4></div></div></div><p>The generate and reserve endpoint is used by offline clients that needs to be able to
          register tracked entities with unique ids. They will reserve a number of unique ids that
          this device will then use when registering new tracked entity instances. The endpoint is
          called to retreieve a number of tracked entity instance reserved values. An optional
          parameter numberToReserve specifies how many ids to generate (default is 1). </p><pre class="screen">curl -X GET -H "Content-Type: application/json" -u admin:district 
          https://play.dhis2.org/dev/api/trackedEntityAttributes/lZGmxYbs97q/generateAndReserve?numberToReserve=3</pre><pre class="screen">[
   {
      "created":"2016-06-25T07:52:26.466+0000",
      "expiryDate":"2017-06-25T07:52:26.466+0000",
      "value":"43327401",
      "trackedEntityAttribute":{  }
   },
   {
      "created":"2016-06-25T07:52:26.468+0000",
      "expiryDate":"2017-06-25T07:52:26.468+0000",
      "value":"82676084",
      "trackedEntityAttribute":{  }
   },
   {
      "created":"2016-06-25T07:52:26.471+0000",
      "expiryDate":"2017-06-25T07:52:26.471+0000",
      "value":"91700776",
      "trackedEntityAttribute":{  }
   }
]
        </pre><p>The generate and reserve endpoint returns an array of reserved values:</p><div class="table"><a name="d0e12173"></a><p class="title"><b>Table&nbsp;1.93.&nbsp;Tracked entity reserved values</b></p><div class="table-contents"><table class="table" summary="Tracked entity reserved values" border="1"><colgroup><col class="c1"><col class="c3"></colgroup><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>created</td><td>The date the reserved value was created.</td></tr><tr><td>expiryDate</td><td>After this date the value can be deleted/unreserved by the server if  no
                  tracked entity has been registered with the value. The deletion does not happen
                  automatically at the exact time of the expiration, but can/will be done with
                  scripts or mechanisms implemneted later.</td></tr><tr><td>value</td><td>The actual generated value that is reserved.</td></tr><tr><td>trackedEntityAttribute</td><td>The tracked entity attribute that the value was generated for.</td></tr></tbody></table></div></div><br class="table-break"></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s57.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch01s59.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.57.&nbsp;SVG conversion&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.59.&nbsp;Tracked entity instance query</td></tr></table></div></body></html>